<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Valgbar – Folketingsvalg 2019</title>

  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .vb-card { background:#fff; border:1px solid #e5e7eb; border-radius:14px; box-shadow:0 1px 2px rgba(15,23,42,.04); }
    .vb-row { transition: background .15s ease; }
    .vb-row:hover { background:#f8fafc; }

    /* highlight når man deep-linkes til en kandidat */
    .vb-deeplink-highlight {
      outline: 2px solid #0f766e;
      box-shadow: 0 0 0 4px rgba(15,118,110,.15);
      border-radius: 10px;
      transition: outline-color .25s ease, box-shadow .25s ease;
    }

    /* badge til partibogstav */
    .vb-badge {
      display:inline-flex; align-items:center; justify-content:center;
      width:28px; height:28px; border-radius:999px;
      border:1px solid #d1d5db; background:#e5e7eb; color:#111827; font-weight:700;
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-900">
  <!-- HEADER -->
  <header class="bg-white border-b">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between gap-4">
      <a href="/" class="flex items-center gap-2">
        <img src="/Valgbar-transparent3.png" alt="Valgbar" class="h-10 w-auto" />
      </a>
      <div class="text-right">
        <div class="text-xs text-slate-600 font-semibold uppercase tracking-wide">Folketingsvalg</div>
        <div class="text-lg font-semibold">2019 – kandidater</div>
      </div>
    </div>
  </header>

  <!-- INDHOLD -->
  <main class="max-w-6xl mx-auto p-4 md:p-6 space-y-6">

    <!-- FILTRE (valgfrit) -->
    <section class="vb-card p-4 md:p-5">
      <div class="flex flex-col md:flex-row items-start md:items-end gap-3">
        <div class="flex-1">
          <label class="text-xs font-medium text-slate-600">Søg kandidat</label>
          <input type="text" id="quickFilter" class="w-full border rounded-md px-3 py-2 text-sm"
                 placeholder="Filtrér lokalt på denne side…" />
        </div>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-2 w-full md:w-auto">
          <select id="filterStorkreds" class="border rounded-md px-2 py-2 text-sm">
            <option value="">Alle storkredse</option>
            <!-- udfyld evt. dynamisk -->
          </select>
          <select id="filterParty" class="border rounded-md px-2 py-2 text-sm">
            <option value="">Alle partier</option>
            <option value="A">A – Socialdemokratiet</option>
            <option value="V">V – Venstre</option>
            <option value="Ø">Ø – Enhedslisten</option>
            <option value="C">C – Konservative</option>
            <option value="B">B – Radikale</option>
            <option value="F">F – SF</option>
            <option value="I">I – Liberal Alliance</option>
            <option value="O">O – Dansk Folkeparti</option>
            <option value="K">K – Kristendemokraterne</option>
            <option value="Å">Å – Alternativet</option>
            <!-- tilføj flere efter behov -->
          </select>
          <button id="btnClear" class="border rounded-md px-3 py-2 text-sm">Nulstil filtre</button>
        </div>
      </div>
    </section>

    <!-- KANDIDATLISTE -->
    <section class="vb-card p-0 overflow-hidden">
      <div class="border-b px-4 py-3 flex items-center justify-between">
        <h2 class="font-semibold">Kandidater</h2>
        <div id="count" class="text-sm text-slate-600"></div>
      </div>

      <!--
        VIGTIGT:
        - Dine rækker SKAL have:
          data-candidate-id  = samme id som i candidate-sources/ft2019.json
          data-name          = kandidatens visningsnavn
          data-party-short   = partibogstav (A/V/Ø/...)
          data-party         = partinavn (valgfrit)
          data-storkreds     = (valgfrit – gør links/filtre bedre)
          data-kreds         = (valgfrit)
        - Hvis du allerede har din egen rendering, kan du erstatte <tbody id="candRows">…</tbody>
          med din genererede liste. Deep-link scriptet virker uanset.
      -->
      <table class="min-w-full">
        <thead class="bg-slate-100 text-slate-700 text-xs uppercase">
          <tr>
            <th class="text-left px-3 py-2">Parti</th>
            <th class="text-left px-3 py-2">Navn</th>
            <th class="text-left px-3 py-2">Storkreds</th>
            <th class="text-right px-3 py-2">Stemmer</th>
            <th class="px-3 py-2"></th>
          </tr>
        </thead>
        <tbody id="candRows" class="divide-y divide-slate-100 text-sm bg-white">
          <!-- Eksempel-rækker (kan fjernes – du har sandsynligvis din egen rendering): -->
          <tr class="vb-row"
              data-candidate-id="A_Mette_Frederiksen"
              data-name="Mette Frederiksen"
              data-party-short="A"
              data-party="Socialdemokratiet"
              data-storkreds="Nordre Storkreds"
              data-kreds="Ballerupkredsen">
            <td class="px-3 py-2"><span class="vb-badge" style="background:#e03a3e;color:#fff;border-color:#e03a3e">A</span></td>
            <td class="px-3 py-2 font-medium">Mette Frederiksen</td>
            <td class="px-3 py-2">Nordre Storkreds</td>
            <td class="px-3 py-2 text-right">24.486</td>
            <td class="px-3 py-2">
              <button class="text-sky-700 hover:underline" data-action="open-candidate">Åbn</button>
            </td>
          </tr>

          <tr class="vb-row"
              data-candidate-id="V_Eksempel_Person"
              data-name="Eksempel Person"
              data-party-short="V"
              data-party="Venstre, Danmarks Liberale Parti"
              data-storkreds="Københavns Omegns Storkreds"
              data-kreds="Brøndbykredsen">
            <td class="px-3 py-2"><span class="vb-badge" style="background:#1b5eaa;color:#fff;border-color:#1b5eaa">V</span></td>
            <td class="px-3 py-2 font-medium">Eksempel Person</td>
            <td class="px-3 py-2">Københavns Omegns Storkreds</td>
            <td class="px-3 py-2 text-right">5.432</td>
            <td class="px-3 py-2">
              <button class="text-sky-700 hover:underline" data-action="open-candidate">Åbn</button>
            </td>
          </tr>
          <!-- /eksempler -->
        </tbody>
      </table>

      <!-- her kan din detaljevisning leve (kan være en sidemodal, panel el.lign.) -->
      <div id="candidateDetail" class="hidden border-t p-4"></div>
    </section>
  </main>

  <footer class="mt-10 border-t bg-slate-100">
    <div class="max-w-6xl mx-auto px-4 py-6 text-xs text-slate-600 flex items-center justify-between">
      <span>Valgbar – FT 2019</span>
      <span>Data: KMDValg, Danmarks Statistik, valg.dk</span>
    </div>
  </footer>

  <!-- FT 2019: interaktion + deep-link -->
  <script>
    // Simple lokalfilter (valgfrit – kan fjernes)
    (function setupLocalFilter(){
      const input = document.getElementById('quickFilter');
      const rows  = () => Array.from(document.querySelectorAll('#candRows tr.vb-row'));
      const count = document.getElementById('count');

      function apply(){
        const q = (input.value || '').trim().toLowerCase();
        let visible = 0;
        rows().forEach(r=>{
          const name  = (r.getAttribute('data-name') || '').toLowerCase();
          const party = (r.getAttribute('data-party-short') || r.getAttribute('data-party') || '').toLowerCase();
          const stork = (r.getAttribute('data-storkreds') || '').toLowerCase();
          const kreds = (r.getAttribute('data-kreds') || '').toLowerCase();
          const show = !q || name.includes(q) || party.includes(q) || stork.includes(q) || kreds.includes(q);
          r.classList.toggle('hidden', !show);
          if (show) visible++;
        });
        if (count) count.textContent = visible + ' kandidater vist';
      }

      input?.addEventListener('input', apply);
      document.getElementById('filterParty')?.addEventListener('change', e=>{
        const val = (e.target.value || '').toLowerCase();
        Array.from(document.querySelectorAll('#candRows tr.vb-row')).forEach(r=>{
          const p = (r.getAttribute('data-party-short') || '').toLowerCase();
          const show = !val || p === val;
          r.classList.toggle('hidden', !show);
        });
        apply();
      });
      document.getElementById('filterStorkreds')?.addEventListener('change', e=>{
        const val = (e.target.value || '').toLowerCase();
        Array.from(document.querySelectorAll('#candRows tr.vb-row')).forEach(r=>{
          const s = (r.getAttribute('data-storkreds') || '').toLowerCase();
          const show = !val || s === val;
          r.classList.toggle('hidden', !show);
        });
        apply();
      });
      document.getElementById('btnClear')?.addEventListener('click', ()=>{
        if (input) input.value = '';
        const p = document.getElementById('filterParty'); if (p) p.value = '';
        const s = document.getElementById('filterStorkreds'); if (s) s.value = '';
        Array.from(document.querySelectorAll('#candRows tr.vb-row')).forEach(r=> r.classList.remove('hidden'));
        apply();
      });

      apply();
    })();

    /* ==============================
       Deep-link fra forsiden (FT)
       ============================== */
    const ROW_SELECTOR      = '#candRows tr.vb-row';
    const GET_ID            = el => el.getAttribute('data-candidate-id') || '';
    const GET_META          = el => ({
      name: (el.getAttribute('data-name') || '').trim(),
      partyShort: (el.getAttribute('data-party-short') || '').trim(),
      party: (el.getAttribute('data-party') || '').trim()
    });
    const OPEN_BTN_SELECTOR = '[data-action="open-candidate"]';

    function activateRow(row){
      // scroll + highlight
      row.scrollIntoView({ behavior: 'smooth', block: 'center' });
      row.classList.add('vb-deeplink-highlight');
      setTimeout(()=> row.classList.remove('vb-deeplink-highlight'), 2500);

      // klik på “åbn”-knap hvis den findes – ellers klik på rækken
      const openBtn = row.querySelector(OPEN_BTN_SELECTOR);
      if (openBtn) openBtn.click();
      else if (typeof row.click === 'function') row.click();
    }

    function params(){
      const p = new URLSearchParams(location.search);
      const out = {
        cid:   (p.get('cid')   || '').trim(),
        cand:  (p.get('cand')  || '').trim(), // A::Navn eller bare Navn
        party: (p.get('party') || '').trim(), // bogstav eller navn
        kreds: (p.get('kreds') || '').trim(),
        storkreds: (p.get('storkreds') || '').trim()
      };
      return out;
    }
    function norm(s){
      return (s||'').toString()
        .normalize('NFD').replace(/\p{Diacritic}/gu,'')
        .toLowerCase().replace(/\s+/g,' ').trim();
    }

    function matchByCid(cid){
      if (!cid) return null;
      const esc = CSS.escape(cid);
      return document.querySelector(`${ROW_SELECTOR}[data-candidate-id="${esc}"]`);
    }
    function matchByPartyAndName(party, cand){
      // cand kan være "A::Navn"
      let partyHint = (party || '').trim();
      let name = (cand || '').trim();

      if (name.includes('::')) {
        const parts = name.split('::');
        partyHint = partyHint || parts[0];
        name = parts.slice(1).join('::');
      }

      const wantName = norm(name);
      const wantParty = norm(partyHint);

      const rows = Array.from(document.querySelectorAll(ROW_SELECTOR));
      for (const row of rows) {
        const meta = GET_META(row);
        const rowName = norm(meta.name);
        const rowPartyShort = norm(meta.partyShort);
        const rowParty = norm(meta.party);
        if (rowName === wantName) {
          if (!wantParty) return row;
          if (wantParty === rowPartyShort || wantParty === rowParty) return row;
        }
      }
      return null;
    }

    document.addEventListener('DOMContentLoaded', () => {
      const { cid, party, cand } = params();

      // 1) præcist id
      let row = matchByCid(cid);
      if (row) { activateRow(row); return; }

      // 2) parti + navn / "A::Navn"
      row = matchByPartyAndName(party, cand);
      if (row) { activateRow(row); return; }

      // 3) sidste fallback: kun navn fra cand
      if (cand) {
        const nameOnly = cand.includes('::') ? cand.split('::').slice(1).join('::') : cand;
        const want = norm(nameOnly);
        const rows = Array.from(document.querySelectorAll(ROW_SELECTOR));
        const hit = rows.find(r => norm(GET_META(r).name) === want);
        if (hit) activateRow(hit);
      }
    });

    // DEMO “åbn”-knap – viser detalje under tabellen (tilpas til dit UI)
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-action="open-candidate"]');
      if(!btn) return;
      const row = btn.closest('tr');
      const meta = GET_META(row);
      const cid  = GET_ID(row);
      const stork = row.getAttribute('data-storkreds') || '';
      const kreds = row.getAttribute('data-kreds') || '';
      const detail = document.getElementById('candidateDetail');
      detail.classList.remove('hidden');
      detail.innerHTML = `
        <div class="text-sm">
          <div class="font-semibold text-slate-800 mb-1">${meta.name}</div>
          <div class="text-slate-600">Parti: ${meta.party || meta.partyShort || '—'} · ID: <code>${cid}</code></div>
          <div class="text-slate-600">Storkreds: ${stork || '—'} · Kreds: ${kreds || '—'}</div>
        </div>`;
      // scroll til detalje på mobil
      detail.scrollIntoView({ behavior:'smooth', block:'nearest' });
    });
  </script>
</body>
</html>
