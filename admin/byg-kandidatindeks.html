<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Valgbar – Admin – Kandidatindeks (optimeret)</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    .vb-card { background:#fff; border-radius:16px; border:1px solid #e5e7eb; box-shadow:0 1px 2px rgba(15,23,42,.05); }
    .vb-btn { display:inline-flex; align-items:center; justify-content:center; gap:.5rem; padding:.6rem 1rem; border-radius:999px; border:1px solid #0f172a; background:#0f172a; color:#f9fafb; font-weight:500; cursor:pointer; }
    .vb-btn:disabled { opacity:.5; cursor:not-allowed; }
    code { background:#f3f4f6; border-radius:4px; padding:.1rem .3rem; font-size:.85em; }
    .vb-log { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; max-height:260px; overflow:auto; }
  </style>
</head>

<body class="bg-slate-50 text-slate-900">
<header class="border-b bg-white">
  <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between gap-4">
    <div class="flex items-center gap-3">
      <a href="/" class="flex items-center gap-2">
        <img src="/Valgbar-transparent3.png" alt="Valgbar" class="h-10 w-auto" />
      </a>
      <div class="flex flex-col">
        <span class="text-sm font-semibold text-slate-700 uppercase tracking-wide">Admin</span>
        <span class="text-lg font-semibold text-slate-900">Kandidatindeks – opbygning (optimeret)</span>
      </div>
    </div>
    <span class="text-xs text-slate-500">Kun til internt brug</span>
  </div>
</header>

<main class="max-w-5xl mx-auto px-4 py-6 space-y-6">
  <section class="vb-card p-4 md:p-5 space-y-3">
    <h1 class="text-xl md:text-2xl font-semibold">Byg globalt kandidatindeks</h1>
    <p class="text-sm md:text-base text-slate-700">
      Denne version er optimeret, så den ikke forsøger at vise hele JSON’en i browseren. Du får en download-knap
      og kan evt. se en begrænset tekstforhåndsvisning.
    </p>
  </section>

  <section class="vb-card p-4 md:p-5 space-y-3">
    <div class="flex items-center justify-between gap-2">
      <h2 class="text-lg font-semibold">Valg i kandidatindekset</h2>
      <span class="text-xs text-slate-500">Konfiguration styres i JS.</span>
    </div>
    <div class="overflow-auto">
      <table class="min-w-full text-sm border border-slate-200 rounded-lg overflow-hidden">
        <thead class="bg-slate-100 text-slate-700">
        <tr>
          <th class="text-left px-3 py-2 border-b">Valg</th>
          <th class="text-left px-3 py-2 border-b">År</th>
          <th class="text-left px-3 py-2 border-b">Nøgle</th>
          <th class="text-left px-3 py-2 border-b">Data-mappe</th>
          <th class="text-left px-3 py-2 border-b">Detalje-side</th>
          <th class="text-left px-3 py-2 border-b">Kandidat-kilde</th>
        </tr>
        </thead>
        <tbody id="electionTableBody" class="divide-y divide-slate-100 bg-white"></tbody>
      </table>
    </div>
  </section>

  <section class="vb-card p-4 md:p-5 space-y-4">
    <div class="flex items-center justify-between gap-3">
      <div>
        <h2 class="text-lg font-semibold">Byg kandidatindeks</h2>
        <p class="text-xs text-slate-600">Ingen filer skrives automatisk – du downloader JSON’en herfra.</p>
      </div>
      <div class="flex items-center gap-2">
        <button id="btnBuildIndex" class="vb-btn text-sm">Byg kandidatindeks</button>
        <a id="btnDownload" class="vb-btn text-sm disabled:pointer-events-none" download="candidate-index.json" style="background:#2563eb;border-color:#2563eb">Download JSON</a>
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-4">
      <div>
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">Status</h3>
          <div class="text-xs text-slate-500" id="stats"></div>
        </div>
        <div id="buildStatus" class="vb-log text-xs text-slate-700 border border-slate-200 rounded-md p-2 bg-white"></div>
      </div>
      <div>
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">Forhåndsvisning (tekst)</h3>
          <button id="btnShowPreview" class="vb-btn text-xs" style="background:#334155;border-color:#334155">Vis som tekst (max 500 KB)</button>
        </div>
        <textarea id="outputJson" class="w-full h-64 border border-slate-200 rounded-lg text-xs font-mono p-2 bg-slate-50" placeholder="Ingen forhåndsvisning endnu…" spellcheck="false"></textarea>
      </div>
    </div>
  </section>
</main>

<footer class="border-t bg-slate-100 mt-8">
  <div class="max-w-5xl mx-auto px-4 py-4 text-xs text-slate-500 flex flex-wrap items-center justify-between gap-2">
    <span>Valgbar · Admin-værktøj (kandidatindeks)</span>
    <span>Side genereres statisk – ingen server-side ændringer</span>
  </div>
</footer>

<script>
  // ---------- KONFIG ----------
  const VB_ELECTION_SOURCES = [
    // FT
    { key:"ft2022", label:"Folketingsvalg", year:2022, type:"ft", dataRoot:"../data/ft/2022/", detailUrl:"/ft/2022/", candidateSource:"../data/candidate-sources/ft2022.json" },
    { key:"ft2019", label:"Folketingsvalg", year:2019, type:"ft", dataRoot:"../data/ft/2019/", detailUrl:"/ft/2019/", candidateSource:"../data/candidate-sources/ft2019.json" },
    { key:"ft2015", label:"Folketingsvalg", year:2015, type:"ft", dataRoot:"../data/ft/2015/", detailUrl:"/ft/2015/", candidateSource:"../data/candidate-sources/ft2015.json" },
    { key:"ft2011", label:"Folketingsvalg", year:2011, type:"ft", dataRoot:"../data/ft/2011/", detailUrl:"/ft/2011/", candidateSource:"../data/candidate-sources/ft2011.json" },
    { key:"ft2007", label:"Folketingsvalg", year:2007, type:"ft", dataRoot:"../data/ft/2007/", detailUrl:"/ft/2007/", candidateSource:"../data/candidate-sources/ft2007.json" },
    // KV
    { key:"kv2021", label:"Kommunalvalg", year:2021, type:"kv", dataRoot:"../data/kv/2021/", detailUrl:"/kv/2021/", candidateSource:"../data/candidate-sources/kv2021.json" },
    { key:"kv2017", label:"Kommunalvalg", year:2017, type:"kv", dataRoot:"../data/kv/2017/", detailUrl:"/kv/2017/", candidateSource:"../data/candidate-sources/kv2017.json" },
    { key:"kv2013", label:"Kommunalvalg", year:2013, type:"kv", dataRoot:"../data/kv/2013/", detailUrl:"/kv/2013/", candidateSource:"../data/candidate-sources/kv2013.json" },
    { key:"kv2009", label:"Kommunalvalg", year:2009, type:
